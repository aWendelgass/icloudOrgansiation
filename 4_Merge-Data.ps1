# ===================================================================# Skript zur Umwandlung von Koordinaten in Adressen## ** Damit das Skript ausgeführt werden kann müssen die Policies **# ** Für die Dauer des Prozesses geändert werden, dazu habe ich  **# ** Die Batchdatei 4_doMerge-Data.bat etstellt, die kümmert     **# ** sich darum und ruft das Script auf                          **## Das Skript gehört zu einem Set of 5: Wenn alles ordnungsgemäß abläuft # könnt ihr damit eine beliebiege Verzeichnissttruktur  von Bild und # Video Medien organsieren. Das heisst: Umbenennen, verschieben, # doppelte entfernen. ## 4_Merge-Data.ps1## Dieses Skript kombiniert nun die erste Datei 1_Media-Export.csv mit den gewonnen Adressen# und erstellt 4_Media-Export_extended.csv mit folgenden Spalten##  + Pfad:#  + Dateiname#  + Dateiname_ohne_Extension#  + Extension#  + Erstelldatum_Zeit_des_Mediums#  + latitude#  + longitude#  + Adresse (inklusve Ort, Land PLZ, Strasse, Hausnummer, Bezirk)###region Konfiguration$SkriptName = "Skript 4: Daten zusammenfuehren"$InputCsv_Full = Join-Path -Path $PSScriptRoot -ChildPath "1_Media-Export.csv"$InputCsv_Lookup = Join-Path -Path $PSScriptRoot -ChildPath "3_Koordinaten_mit_Adressen.csv"$OutputCsv_Final = Join-Path -Path $PSScriptRoot -ChildPath "4_Media-Export_extended.csv"#endregion# --- Lade Logging Modul ---try {    Import-Module -Name (Join-Path -Path $PSScriptRoot -ChildPath "MediaWorkflowLogger.psm1")} catch {    Write-Host "FEHLER: Das Logging-Modul 'MediaWorkflowLogger.psm1' konnte nicht geladen werden." -ForegroundColor Red    pause    return}# --- Skript-Logik ---Write-StructuredLog -LogLevel INFO -SkriptName $SkriptName -Message "Lese Adress-Datei ein: $InputCsv_Lookup"try {    $lookupData = Import-Csv -Path $InputCsv_Lookup -Delimiter ';'} catch {    Write-StructuredLog -LogLevel ERROR -SkriptName $SkriptName -Message "Fehler beim Einlesen der Adress-Datei: $($_.Exception.Message)"    pause    return}$addressLookup = @{}foreach ($item in $lookupData) { $addressLookup[$item.LATLONG] = $item.Adresse }Write-StructuredLog -LogLevel INFO -SkriptName $SkriptName -Message "Lese grosse Mediendatei ein: $InputCsv_Full"try {    $fullData = Import-Csv -Path $InputCsv_Full -Delimiter ';'} catch {    Write-StructuredLog -LogLevel ERROR -SkriptName $SkriptName -Message "Fehler beim Einlesen der Mediendatei: $($_.Exception.Message)"    pause    return}Write-StructuredLog -LogLevel INFO -SkriptName $SkriptName -Message "Fuege Adressen zu den $($fullData.Count) Datensaetzen hinzu..."foreach ($row in $fullData) {    $foundAddress = "Keine GPS-Daten"    if ($row.latitude -and $row.longitude -and $row.latitude -ne "") {        # FINALE LOGIK: Normalisiert den Input (ersetzt Komma durch Punkt) und arbeitet dann nur noch mit Text.        $latNormalized = $row.latitude.Replace(',', '.')        $lonNormalized = $row.longitude.Replace(',', '.')        if ($latNormalized.Contains('.')) {            $latParts = $latNormalized.Split('.')            $latRounded = $latParts[0] + "," + $latParts[1].PadRight(5, '0').Substring(0, 5)            $lonParts = $lonNormalized.Split('.')            $lonRounded = $lonParts[0] + "," + $lonParts[1].PadRight(5, '0').Substring(0, 5)            $current_latlong = "$latRounded#$lonRounded"            if ($addressLookup.ContainsKey($current_latlong)) {                $foundAddress = $addressLookup[$current_latlong]            } else {                 $foundAddress = "Adresse nicht gefunden"                Write-StructuredLog -LogLevel WARN -SkriptName $SkriptName -Message "Konnte Adresse fuer Koordinate $current_latlong nicht in der Lookup-Datei finden."            }        }    }    Add-Member -InputObject $row -MemberType NoteProperty -Name "Adresse" -Value $foundAddress    # ==================== HIER SIND NEUE SPALTEN für die weitere Bearbeitung ====================    Add-Member -InputObject $row -MemberType NoteProperty -Name "Beschreibung" -Value ""    Add-Member -InputObject $row -MemberType NoteProperty -Name "Neues_Verzeichnis" -Value ""    Add-Member -InputObject $row -MemberType NoteProperty -Name "Neuer_Name" -Value ""    Add-Member -InputObject $row -MemberType NoteProperty -Name "Erledigt_Status" -Value ""    # ============================================================================================}Write-StructuredLog -LogLevel INFO -SkriptName $SkriptName -Message "Speichere die finale, vollstaendige CSV-Datei..."$fullData | Export-Csv -Path $OutputCsv_Final -Delimiter ';' -NoTypeInformation -Encoding UTF8Write-StructuredLog -LogLevel INFO -SkriptName $SkriptName -Message "FERTIG! Datei '$OutputCsv_Final' wurde erstellt."pause